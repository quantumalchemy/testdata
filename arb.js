var oddsData = [{"id":"cd5df834f45053bfaba6f2f09c44a113","sport_key":"basketball_nba","sport_title":"NBA","commence_time":"2023-03-13T23:10:00Z","home_team":"Detroit Pistons","away_team":"Indiana Pacers","bookmakers":[{"key":"draftkings","title":"DraftKings","last_update":"2023-03-13T16:10:57Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:57Z","outcomes":[{"name":"Detroit Pistons","price":135},{"name":"Indiana Pacers","price":-155}]}]},{"key":"fanduel","title":"FanDuel","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Detroit Pistons","price":134},{"name":"Indiana Pacers","price":-158}]}]},{"key":"betmgm","title":"BetMGM","last_update":"2023-03-13T16:10:58Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:58Z","outcomes":[{"name":"Detroit Pistons","price":130},{"name":"Indiana Pacers","price":-155}]}]},{"key":"betus","title":"BetUS","last_update":"2023-03-13T16:10:23Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:23Z","outcomes":[{"name":"Detroit Pistons","price":140},{"name":"Indiana Pacers","price":-160}]}]},{"key":"williamhill_us","title":"William Hill (US)","last_update":"2023-03-13T16:11:13Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:11:13Z","outcomes":[{"name":"Detroit Pistons","price":140},{"name":"Indiana Pacers","price":-165}]}]},{"key":"mybookieag","title":"MyBookie.ag","last_update":"2023-03-13T16:10:58Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:58Z","outcomes":[{"name":"Detroit Pistons","price":121},{"name":"Indiana Pacers","price":-147}]}]},{"key":"barstool","title":"Barstool Sportsbook","last_update":"2023-03-13T16:09:49Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:09:49Z","outcomes":[{"name":"Detroit Pistons","price":128},{"name":"Indiana Pacers","price":-152}]}]},{"key":"betrivers","title":"BetRivers","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Detroit Pistons","price":128},{"name":"Indiana Pacers","price":-152}]}]},{"key":"sugarhouse","title":"SugarHouse","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Detroit Pistons","price":128},{"name":"Indiana Pacers","price":-152}]}]},{"key":"twinspires","title":"TwinSpires","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Detroit Pistons","price":128},{"name":"Indiana Pacers","price":-152}]}]},{"key":"unibet_us","title":"Unibet","last_update":"2023-03-13T16:10:23Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:23Z","outcomes":[{"name":"Detroit Pistons","price":128},{"name":"Indiana Pacers","price":-152}]}]},{"key":"foxbet","title":"FOX Bet","last_update":"2023-03-13T16:06:54Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:06:54Z","outcomes":[{"name":"Detroit Pistons","price":120},{"name":"Indiana Pacers","price":-167}]}]},{"key":"pointsbetus","title":"PointsBet (US)","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Detroit Pistons","price":130},{"name":"Indiana Pacers","price":-150}]}]},{"key":"lowvig","title":"LowVig.ag","last_update":"2023-03-13T16:09:58Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:09:58Z","outcomes":[{"name":"Detroit Pistons","price":135},{"name":"Indiana Pacers","price":-155}]}]},{"key":"betonlineag","title":"BetOnline.ag","last_update":"2023-03-13T16:10:57Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:57Z","outcomes":[{"name":"Detroit Pistons","price":135},{"name":"Indiana Pacers","price":-156}]}]},{"key":"bovada","title":"Bovada","last_update":"2023-03-13T16:08:15Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:08:15Z","outcomes":[{"name":"Detroit Pistons","price":135},{"name":"Indiana Pacers","price":-160}]}]},{"key":"wynnbet","title":"WynnBET","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Detroit Pistons","price":135},{"name":"Indiana Pacers","price":-159}]}]},{"key":"circasports","title":"Circa Sports","last_update":"2023-03-13T16:10:57Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:57Z","outcomes":[{"name":"Detroit Pistons","price":131},{"name":"Indiana Pacers","price":-159}]}]},{"key":"superbook","title":"SuperBook","last_update":"2023-03-13T16:10:24Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:24Z","outcomes":[{"name":"Detroit Pistons","price":140},{"name":"Indiana Pacers","price":-160}]}]}]},{"id":"c506e4b99e91a74455df8e1774f0dc0b","sport_key":"basketball_nba","sport_title":"NBA","commence_time":"2023-03-13T23:40:00Z","home_team":"Atlanta Hawks","away_team":"Minnesota Timberwolves","bookmakers":[{"key":"draftkings","title":"DraftKings","last_update":"2023-03-13T16:10:57Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:57Z","outcomes":[{"name":"Atlanta Hawks","price":-210},{"name":"Minnesota Timberwolves","price":180}]}]},{"key":"williamhill_us","title":"William Hill (US)","last_update":"2023-03-13T16:11:13Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:11:13Z","outcomes":[{"name":"Atlanta Hawks","price":-225},{"name":"Minnesota Timberwolves","price":185}]}]},{"key":"lowvig","title":"LowVig.ag","last_update":"2023-03-13T16:09:58Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:09:58Z","outcomes":[{"name":"Atlanta Hawks","price":-208},{"name":"Minnesota Timberwolves","price":178}]}]},{"key":"betonlineag","title":"BetOnline.ag","last_update":"2023-03-13T16:10:57Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:57Z","outcomes":[{"name":"Atlanta Hawks","price":-208},{"name":"Minnesota Timberwolves","price":178}]}]},{"key":"bovada","title":"Bovada","last_update":"2023-03-13T16:08:15Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:08:15Z","outcomes":[{"name":"Atlanta Hawks","price":-210},{"name":"Minnesota Timberwolves","price":175}]}]},{"key":"wynnbet","title":"WynnBET","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Atlanta Hawks","price":-213},{"name":"Minnesota Timberwolves","price":175}]}]},{"key":"fanduel","title":"FanDuel","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Atlanta Hawks","price":-210},{"name":"Minnesota Timberwolves","price":176}]}]},{"key":"superbook","title":"SuperBook","last_update":"2023-03-13T16:10:24Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:24Z","outcomes":[{"name":"Atlanta Hawks","price":-210},{"name":"Minnesota Timberwolves","price":180}]}]},{"key":"betmgm","title":"BetMGM","last_update":"2023-03-13T16:10:58Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:58Z","outcomes":[{"name":"Atlanta Hawks","price":-210},{"name":"Minnesota Timberwolves","price":170}]}]},{"key":"betus","title":"BetUS","last_update":"2023-03-13T16:10:23Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:23Z","outcomes":[{"name":"Atlanta Hawks","price":-210},{"name":"Minnesota Timberwolves","price":175}]}]},{"key":"pointsbetus","title":"PointsBet (US)","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Atlanta Hawks","price":-210},{"name":"Minnesota Timberwolves","price":175}]}]},{"key":"circasports","title":"Circa Sports","last_update":"2023-03-13T16:10:57Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:57Z","outcomes":[{"name":"Atlanta Hawks","price":-209},{"name":"Minnesota Timberwolves","price":168}]}]},{"key":"mybookieag","title":"MyBookie.ag","last_update":"2023-03-13T16:10:58Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:58Z","outcomes":[{"name":"Atlanta Hawks","price":-204},{"name":"Minnesota Timberwolves","price":164}]}]},{"key":"barstool","title":"Barstool Sportsbook","last_update":"2023-03-13T16:09:49Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:09:49Z","outcomes":[{"name":"Atlanta Hawks","price":-210},{"name":"Minnesota Timberwolves","price":175}]}]},{"key":"betrivers","title":"BetRivers","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Atlanta Hawks","price":-210},{"name":"Minnesota Timberwolves","price":175}]}]},{"key":"sugarhouse","title":"SugarHouse","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Atlanta Hawks","price":-210},{"name":"Minnesota Timberwolves","price":175}]}]},{"key":"twinspires","title":"TwinSpires","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Atlanta Hawks","price":-210},{"name":"Minnesota Timberwolves","price":175}]}]},{"key":"unibet_us","title":"Unibet","last_update":"2023-03-13T16:10:23Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:23Z","outcomes":[{"name":"Atlanta Hawks","price":-210},{"name":"Minnesota Timberwolves","price":175}]}]},{"key":"foxbet","title":"FOX Bet","last_update":"2023-03-13T16:06:54Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:06:54Z","outcomes":[{"name":"Atlanta Hawks","price":-227},{"name":"Minnesota Timberwolves","price":160}]}]}]},{"id":"8e66b055d9a3546e8a78fdd37fba90f8","sport_key":"basketball_nba","sport_title":"NBA","commence_time":"2023-03-13T23:40:00Z","home_team":"Dallas Mavericks","away_team":"Memphis Grizzlies","bookmakers":[{"key":"fanduel","title":"FanDuel","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Dallas Mavericks","price":102},{"name":"Memphis Grizzlies","price":-120}]}]},{"key":"draftkings","title":"DraftKings","last_update":"2023-03-13T16:10:57Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:57Z","outcomes":[{"name":"Dallas Mavericks","price":100},{"name":"Memphis Grizzlies","price":-120}]}]},{"key":"betmgm","title":"BetMGM","last_update":"2023-03-13T16:10:58Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:58Z","outcomes":[{"name":"Dallas Mavericks","price":100},{"name":"Memphis Grizzlies","price":-120}]}]},{"key":"williamhill_us","title":"William Hill (US)","last_update":"2023-03-13T16:11:13Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:11:13Z","outcomes":[{"name":"Dallas Mavericks","price":100},{"name":"Memphis Grizzlies","price":-120}]}]},{"key":"barstool","title":"Barstool Sportsbook","last_update":"2023-03-13T16:09:49Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:09:49Z","outcomes":[{"name":"Dallas Mavericks","price":100},{"name":"Memphis Grizzlies","price":-118}]}]},{"key":"betrivers","title":"BetRivers","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Dallas Mavericks","price":100},{"name":"Memphis Grizzlies","price":-118}]}]},{"key":"sugarhouse","title":"SugarHouse","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Dallas Mavericks","price":100},{"name":"Memphis Grizzlies","price":-118}]}]},{"key":"twinspires","title":"TwinSpires","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Dallas Mavericks","price":100},{"name":"Memphis Grizzlies","price":-118}]}]},{"key":"unibet_us","title":"Unibet","last_update":"2023-03-13T16:10:23Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:23Z","outcomes":[{"name":"Dallas Mavericks","price":100},{"name":"Memphis Grizzlies","price":-118}]}]},{"key":"foxbet","title":"FOX Bet","last_update":"2023-03-13T16:06:54Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:06:54Z","outcomes":[{"name":"Dallas Mavericks","price":100},{"name":"Memphis Grizzlies","price":-139}]}]},{"key":"pointsbetus","title":"PointsBet (US)","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Dallas Mavericks","price":105},{"name":"Memphis Grizzlies","price":-125}]}]},{"key":"mybookieag","title":"MyBookie.ag","last_update":"2023-03-13T16:10:58Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:58Z","outcomes":[{"name":"Dallas Mavericks","price":-116},{"name":"Memphis Grizzlies","price":-105}]}]},{"key":"betonlineag","title":"BetOnline.ag","last_update":"2023-03-13T16:10:57Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:57Z","outcomes":[{"name":"Dallas Mavericks","price":-103},{"name":"Memphis Grizzlies","price":-118}]}]},{"key":"lowvig","title":"LowVig.ag","last_update":"2023-03-13T16:09:58Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:09:58Z","outcomes":[{"name":"Dallas Mavericks","price":-103},{"name":"Memphis Grizzlies","price":-117}]}]},{"key":"bovada","title":"Bovada","last_update":"2023-03-13T16:08:15Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:08:15Z","outcomes":[{"name":"Dallas Mavericks","price":105},{"name":"Memphis Grizzlies","price":-125}]}]},{"key":"wynnbet","title":"WynnBET","last_update":"2023-03-13T16:10:22Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:22Z","outcomes":[{"name":"Dallas Mavericks","price":100},{"name":"Memphis Grizzlies","price":-120}]}]},{"key":"circasports","title":"Circa Sports","last_update":"2023-03-13T16:10:57Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:57Z","outcomes":[{"name":"Dallas Mavericks","price":103},{"name":"Memphis Grizzlies","price":-125}]}]},{"key":"superbook","title":"SuperBook","last_update":"2023-03-13T16:10:24Z","markets":[{"key":"h2h","last_update":"2023-03-13T16:10:24Z","outcomes":[{"name":"Dallas Mavericks","price":100},{"name":"Memphis Grizzlies","price":-120}]}]}]}];
function calculateArbitrage(opportunities) {
  var total = 0;
  for (var i = 0; i < opportunities.length; i++) {
    total += 1 / opportunities[i];
  }
  return 1 / total;
}

function findBookmaker(event, market, outcome) {
  for (var i = 0; i < event.bookmakers.length; i++) {
    var bookmaker = event.bookmakers[i];
    for (var j = 0; j < bookmaker.markets.length; j++) {
      var bookmakerMarket = bookmaker.markets[j];
      if (bookmakerMarket.key === market) {
        for (var k = 0; k < bookmakerMarket.outcomes.length; k++) {
          var bookmakerOutcome = bookmakerMarket.outcomes[k];
          if (bookmakerOutcome.id === outcome.id) {
            return bookmaker;
          }
        }
      }
    }
  }
  return null;
}

function compareBookmakers(bookmaker1, bookmaker2) {
  var bookmaker1Odds = bookmaker1.outcomes[0].price;
  var bookmaker2Odds = bookmaker2.outcomes[0].price;
  var arbOpportunities = [    1 / bookmaker1Odds,    1 / bookmaker2Odds  ];
  var arbProbability = calculateArbitrage(arbOpportunities);
  var potentialProfit = arbProbability - 1;
  return {
    arbProbability: arbProbability,
    potentialProfit: potentialProfit,
    bookmakers: [bookmaker1, bookmaker2]
  };
}

function findBestBookmakers(event, market, outcome) {
  var bookmakers = [];
  for (var i = 0; i < event.bookmakers.length; i++) {
    var bookmaker = event.bookmakers[i];
    for (var j = 0; j < bookmaker.markets.length; j++) {
      var bookmakerMarket = bookmaker.markets[j];
      if (bookmakerMarket.key === market) {
        for (var k = 0; k < bookmakerMarket.outcomes.length; k++) {
          var bookmakerOutcome = bookmakerMarket.outcomes[k];
          if (bookmakerOutcome.id === outcome.id) {
            bookmakers.push(bookmaker);
          }
        }
      }
    }
  }

  if (bookmakers.length < 2) {
    return null;
  }

  var bestBookmakers = [];
  var bestArbProbability = -1;
  var bestPotentialProfit = -1;

  for (var i = 0; i < bookmakers.length; i++) {
    for (var j = i + 1; j < bookmakers.length; j++) {
      var comparison = compareBookmakers(bookmakers[i], bookmakers[j]);
      if (comparison.arbProbability > bestArbProbability || (comparison.arbProbability === bestArbProbability && comparison.potentialProfit > bestPotentialProfit)) {
        bestArbProbability = comparison.arbProbability;
        bestPotentialProfit = comparison.potentialProfit;
        bestBookmakers = comparison.bookmakers;
      }
    }
  }

  return {
    arbProbability: bestArbProbability,
    potentialProfit: bestPotentialProfit,
    bookmakers: bestBookmakers
  };
}
// START
// Loop through all the events and find the best arbitrage opportunities
 // Loop through all the arbitrage opportunities and find the best bookmakers for each outcome

 
for (var j = 0; j < arbOpportunities.length; j++) {
  var opportunity = arbOpportunities[j];
  var event = opportunity;
  // var impliedProbabilities = opportunity.impliedProbabilitie
    // Calculate the implied probabilities and arbitrage opportunity
   
	var bookmakerOdds = opportunity.bookmakers;
;

    ////////
   

  // Find the best two bookmakers for each outcome
  var bookmaker1 = findBookmaker(event,  bookmakerOdds.markets[0].outcome);
  var bookmaker2 = findBookmaker(event,  bookmakerOdds.markets[1].outcome);
  var bookmakers = bookmaker1.key;
  if (bookmaker2.key !== bookmaker1.key) {
    bookmakers += ", " + bookmaker2.key;
  }
  var books = event.home_team + " -> " + bookmakerOdds[0].price.toFixed(2) + " (" + bookmaker1.key + ")" +
              "<br>" + event.away_team + " -> " + bookmakerOdds[1].price.toFixed(2) + " (" + bookmaker2.key + ")";

  // Add the arbitrage opportunity to the list of opportunities
  var opportunityData = {
    percent: (impliedProbabilities[j] * 100).toFixed(2) + "%",
    date: formatDate(event.commence_time),
    event: event.home_team + " vs " + event.away_team,
    market: bookmakerOdds[0].market.key,
    books: books,
    bookmakers: bookmakers
  };
  opportunities.push(opportunityData);
}

// Sort the opportunities by percentage
opportunities.sort(function(a, b) {
  return parseFloat(b.percent) - parseFloat(a.percent);
});

// Print the opportunities to the console
console.log(opportunities);

